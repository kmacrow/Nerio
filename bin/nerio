#!/usr/bin/env node

var fs = require('fs');
var esprima = require('esprima');
var escodegen = require('escodegen');
var esmangle  = require('esmangle');
var argv = require('optimist').argv;


// take a file name from the command line
if( argv._.length ) {

    fs.readFile(argv._[0], 'utf-8', function(err, code) {
        
        if( err ) {
            return console.log( err );
        }

        check( code );
    });

// or, read code from stdin...
} else {

    var code = '';

    process.stdin.resume();
    process.stdin.setEncoding('utf-8');
    process.stdin.on('data', function(buf) { code += buf; });
    process.stdin.on('end', function() {

        check( code );
    
    });
}

// check the code
function check(code) 
{
    // initial AST (abstract syntax tree)
    var ast = esprima.parse(code),

    // compressed/simplified AST
    compressed = esmangle.optimize(ast, null);

    // print the compress/simplified code
    console.log('');
    console.log(escodegen.generate(compressed)); 
    console.log('');

}
